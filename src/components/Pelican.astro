---
// Pelican component with flying and cursor interaction animations
---

<div id="pelican-container" class="pelican-wrapper">
  <svg id="pelican-svg" width="64" height="64" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
    <!-- Body -->
    <g id="pelican-body">
      <rect x="20" y="28" width="4" height="4" fill="#E5E7EB"/>
      <rect x="24" y="28" width="4" height="4" fill="#E5E7EB"/>
      <rect x="28" y="28" width="4" height="4" fill="#E5E7EB"/>
      <rect x="32" y="28" width="4" height="4" fill="#E5E7EB"/>
      <rect x="20" y="32" width="4" height="4" fill="#E5E7EB"/>
      <rect x="24" y="32" width="4" height="4" fill="#E5E7EB"/>
      <rect x="28" y="32" width="4" height="4" fill="#E5E7EB"/>
      <rect x="32" y="32" width="4" height="4" fill="#E5E7EB"/>
      <rect x="36" y="32" width="4" height="4" fill="#E5E7EB"/>
    </g>

    <!-- Head -->
    <g id="pelican-head">
      <rect x="36" y="24" width="4" height="4" fill="#E5E7EB"/>
      <rect x="36" y="28" width="4" height="4" fill="#E5E7EB"/>
      <rect x="40" y="24" width="4" height="4" fill="#E5E7EB"/>
      <!-- Eye -->
      <rect x="40" y="26" width="2" height="2" fill="#1F2937"/>
    </g>

    <!-- Large Beak - Upper -->
    <g id="pelican-beak">
      <rect x="44" y="24" width="4" height="4" fill="#FFA500"/>
      <rect x="48" y="24" width="4" height="4" fill="#FFA500"/>
      <rect x="52" y="26" width="4" height="2" fill="#FFA500"/>
    </g>

    <!-- Large Pouch - Lower Beak -->
    <g id="pelican-pouch">
      <rect x="44" y="28" width="4" height="4" fill="#FF8C00"/>
      <rect x="48" y="28" width="4" height="4" fill="#FF8C00"/>
      <rect x="52" y="28" width="4" height="4" fill="#FF8C00"/>
      <rect x="44" y="32" width="4" height="4" fill="#FF8C00"/>
      <rect x="48" y="32" width="4" height="4" fill="#FF8C00"/>
      <rect x="52" y="32" width="4" height="2" fill="#FF8C00"/>
      <rect x="40" y="32" width="4" height="4" fill="#FF8C00"/>
      <rect x="40" y="36" width="4" height="2" fill="#FF8C00"/>
      <rect x="44" y="36" width="4" height="2" fill="#FF8C00"/>
    </g>

    <!-- Animated Wings -->
    <g id="pelican-wings">
      <g id="wing-left">
        <rect x="24" y="36" width="4" height="4" fill="#D1D5DB"/>
        <rect x="28" y="36" width="4" height="4" fill="#D1D5DB"/>
        <rect x="20" y="38" width="4" height="2" fill="#D1D5DB"/>
      </g>
      <g id="wing-right">
        <rect x="32" y="36" width="4" height="4" fill="#D1D5DB"/>
        <rect x="36" y="38" width="4" height="2" fill="#D1D5DB"/>
      </g>
    </g>

    <!-- Tail -->
    <g id="pelican-tail">
      <rect x="16" y="32" width="4" height="4" fill="#D1D5DB"/>
      <rect x="12" y="34" width="4" height="2" fill="#D1D5DB"/>
    </g>

    <!-- Legs -->
    <g id="pelican-legs">
      <rect x="26" y="40" width="2" height="4" fill="#FFA500"/>
      <rect x="32" y="40" width="2" height="4" fill="#FFA500"/>
      <!-- Feet -->
      <rect x="24" y="44" width="6" height="2" fill="#FFA500"/>
      <rect x="30" y="44" width="6" height="2" fill="#FFA500"/>
    </g>
  </svg>
</div>

<!-- Hidden cursor (fish) when pelican is eating -->
<div id="fish-cursor" class="fish-cursor">
  <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <!-- Pixelated Fish -->
    <rect x="8" y="10" width="2" height="2" fill="#60A5FA"/>
    <rect x="10" y="8" width="2" height="2" fill="#60A5FA"/>
    <rect x="12" y="8" width="2" height="2" fill="#60A5FA"/>
    <rect x="14" y="10" width="2" height="2" fill="#60A5FA"/>
    <rect x="10" y="10" width="2" height="2" fill="#93C5FD"/>
    <rect x="12" y="10" width="2" height="2" fill="#93C5FD"/>
    <rect x="12" y="12" width="2" height="2" fill="#60A5FA"/>
    <rect x="10" y="12" width="2" height="2" fill="#60A5FA"/>
    <!-- Tail -->
    <rect x="6" y="8" width="2" height="2" fill="#60A5FA"/>
    <rect x="6" y="12" width="2" height="2" fill="#60A5FA"/>
    <rect x="4" y="10" width="2" height="2" fill="#60A5FA"/>
    <!-- Eye -->
    <rect x="12" y="9" width="1" height="1" fill="#1F2937"/>
  </svg>
</div>

<style>
  .pelican-wrapper {
    position: fixed;
    z-index: 9999;
    pointer-events: none;
    will-change: transform;
  }

  #pelican-svg {
    filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.2));
    image-rendering: pixelated;
    image-rendering: -moz-crisp-edges;
    image-rendering: crisp-edges;
  }

  .fish-cursor {
    position: fixed;
    pointer-events: none;
    z-index: 9998;
    display: none;
    transform: translate(-50%, -50%);
  }

  .fish-cursor svg {
    image-rendering: pixelated;
    image-rendering: -moz-crisp-edges;
    image-rendering: crisp-edges;
  }

  /* Wing flap animation - visible up and down movement */
  @keyframes flapWings {
    0% {
      transform: translateY(0) rotate(0deg);
    }
    50% {
      transform: translateY(-6px) rotate(-10deg);
    }
    100% {
      transform: translateY(0) rotate(0deg);
    }
  }

  .flapping #wing-left {
    animation: flapWings 0.2s ease-in-out infinite;
    transform-origin: center;
  }

  .flapping #wing-right {
    animation: flapWings 0.2s ease-in-out infinite 0.1s;
    transform-origin: center;
  }
</style>

<script>
  const pelicanContainer = document.getElementById('pelican-container');
  const pelicanSvg = document.getElementById('pelican-svg');
  const fishCursor = document.getElementById('fish-cursor');

  if (pelicanContainer && pelicanSvg && fishCursor) {
    let pelicanX = -80;
    let pelicanY = 30;
    let targetX = pelicanX;
    let targetY = pelicanY;
    let isFlying = false;
    let facingRight = true;
    let isEating = false;
    let headerElement: HTMLElement | null = null;
    let headerHeight = 100;
    let headerTop = 0;

    // Find and measure the header element
    const findHeader = () => {
      headerElement = document.querySelector('header');
      if (headerElement) {
        const rect = headerElement.getBoundingClientRect();
        headerHeight = rect.height;
        headerTop = rect.top;
      }
      return headerElement;
    };

    findHeader();
    window.addEventListener('resize', findHeader);

    // Check if cursor is in header
    const checkCursorInHeader = (x: number, y: number) => {
      if (!headerElement) {
        findHeader();
        if (!headerElement) return false;
      }

      const rect = headerElement.getBoundingClientRect();
      return x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom;
    };

    // Track mouse movement
    let mouseX = 0;
    let mouseY = 0;
    let cursorInHeader = false;

    document.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;

      const wasInHeader = cursorInHeader;
      cursorInHeader = checkCursorInHeader(mouseX, mouseY);

      // If cursor just entered header and pelican isn't already eating
      if (cursorInHeader && !isEating) {
        // Fly to cursor
        isFlying = true;
        isEating = true;
        pelicanSvg.classList.add('flapping');

        // Face the cursor
        if (mouseX > pelicanX) {
          facingRight = true;
          pelicanSvg.style.transform = 'scaleX(1)';
        } else {
          facingRight = false;
          pelicanSvg.style.transform = 'scaleX(-1)';
        }

        targetX = mouseX - 40;
        targetY = mouseY - 30;
      }
    });

    // Random flight pattern
    const startRandomFlight = () => {
      if (isEating) return;

      isFlying = true;
      const viewportWidth = window.innerWidth;

      // Constrain Y to header area
      const minY = headerTop + 10;
      const maxY = headerTop + headerHeight - 80;

      // Fly across screen within header bounds
      if (facingRight) {
        targetX = viewportWidth + 80;
        targetY = minY + Math.random() * Math.max(0, maxY - minY);
      } else {
        targetX = -80;
        targetY = minY + Math.random() * Math.max(0, maxY - minY);
      }

      // Add flapping animation
      pelicanSvg.classList.add('flapping');
    };

    // Eating animation sequence
    const performEatingAnimation = () => {
      // Hide normal cursor, show fish
      document.body.style.cursor = 'none';
      fishCursor.style.display = 'block';
      fishCursor.style.left = `${mouseX}px`;
      fishCursor.style.top = `${mouseY}px`;

      // Fast chomp animation (open/close beak)
      let chompCount = 0;
      const chompInterval = setInterval(() => {
        if (chompCount % 2 === 0) {
          // Beak closed
          pelicanSvg.style.transform = facingRight ? 'scaleX(1) scaleY(0.9)' : 'scaleX(-1) scaleY(0.9)';
        } else {
          // Beak open
          pelicanSvg.style.transform = facingRight ? 'scaleX(1) scaleY(1.1)' : 'scaleX(-1) scaleY(1.1)';
        }
        chompCount++;

        if (chompCount >= 3) {
          clearInterval(chompInterval);

          // Spit out cursor quickly
          setTimeout(() => {
            fishCursor.style.display = 'none';
            document.body.style.cursor = 'auto';

            // Reset pelican
            pelicanSvg.style.transform = facingRight ? 'scaleX(1)' : 'scaleX(-1)';
            pelicanSvg.classList.remove('flapping');

            // Fly away off screen
            isFlying = true;
            pelicanSvg.classList.add('flapping');

            if (facingRight) {
              targetX = window.innerWidth + 80;
            } else {
              targetX = -80;
            }

            // After flying away, reset and schedule next flight
            setTimeout(() => {
              isEating = false;

              // Wait a bit, then start new random flight from opposite side
              setTimeout(() => {
                facingRight = !facingRight;
                pelicanSvg.style.transform = facingRight ? 'scaleX(1)' : 'scaleX(-1)';

                // Reset position to off-screen on the opposite side
                if (facingRight) {
                  pelicanX = -80;
                } else {
                  pelicanX = window.innerWidth + 80;
                }
                pelicanY = headerTop + 30;
                pelicanContainer.style.transform = `translate(${pelicanX}px, ${pelicanY}px)`;

                startRandomFlight();
              }, 2000 + Math.random() * 3000);
            }, 1500);
          }, 100);
        }
      }, 80);
    };

    // Animation loop
    const animate = () => {
      if (isFlying) {
        const dx = targetX - pelicanX;
        const dy = targetY - pelicanY;
        const distance = Math.sqrt(dx * dx + dy * dy);

        if (distance > 3) {
          const speed = isEating ? 12 : 5;
          pelicanX += (dx / distance) * speed;
          pelicanY += (dy / distance) * speed;

          pelicanContainer.style.transform = `translate(${pelicanX}px, ${pelicanY}px)`;
        } else {
          pelicanX = targetX;
          pelicanY = targetY;
          pelicanContainer.style.transform = `translate(${pelicanX}px, ${pelicanY}px)`;

          if (isEating && !fishCursor.style.display.includes('block')) {
            // Reached cursor, perform eating animation
            performEatingAnimation();
          } else if (!isEating) {
            isFlying = false;
            pelicanSvg.classList.remove('flapping');

            // Schedule next flight
            setTimeout(() => {
              facingRight = !facingRight;
              pelicanSvg.style.transform = facingRight ? 'scaleX(1)' : 'scaleX(-1)';
              startRandomFlight();
            }, 3000 + Math.random() * 5000);
          }
        }
      }

      requestAnimationFrame(animate);
    };

    // Initialize position
    pelicanContainer.style.transform = `translate(${pelicanX}px, ${pelicanY}px)`;

    // Start animations
    animate();
    setTimeout(() => {
      startRandomFlight();
    }, 1500);
  }
</script>
